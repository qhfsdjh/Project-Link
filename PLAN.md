# 🚀 执行进度表 - Project Link

> **给 AI 的指导原则**：这个文件定义了开发的重点和节奏，防止"用力过猛"（过度设计）或"原地踏步"（重复工作）。

---

## ⚠️ 开发约束与原则

### 不要做什么（防止用力过猛）
- ❌ **不要**一次性实现所有功能，优先完成当前阶段
- ❌ **不要**过度设计架构，保持简单实用
- ❌ **不要**引入不必要的依赖，保持轻量级
- ❌ **不要**过早优化，先让功能跑起来
- ❌ **不要**硬编码用户习惯，必须通过数据学习

### 必须做什么（防止原地踏步）
- ✅ **必须**在完成每个阶段后更新本文件
- ✅ **必须**保持数据库架构的一致性
- ✅ **必须**为每个新功能编写清晰的文档
- ✅ **必须**使用已有的数据库函数，避免重复造轮子
- ✅ **必须**遵循"数据驱动"原则，通过观察而非猜测

---

## 📊 执行进度

### Phase 1: 基础设施 ✅ (进行中)

**目标**：建立数据存储和基础架构

- [x] ✅ 设计支持进化逻辑的数据库架构 (`database.py`)
  - [x] tasks 表：任务管理
  - [x] preferences 表：用户偏好（置信度机制）
  - [x] memory_logs 表：原始记忆库
  - [x] 性能优化：WAL 模式、索引、缓存
- [x] ✅ 实现核心数据库函数
  - [x] `init_db()`: 初始化
  - [x] `record_interaction()`: 记录交互
  - [x] `update_habit()`: 更新习惯
  - [x] `get_high_confidence_prefs()`: 获取高置信度偏好
- [x] ✅ 编写项目文档
  - [x] README.md（项目说明书）
  - [x] PLAN.md（执行进度表）

**当前状态**：✅ Phase 1 已完成

**下一步**：开始 Phase 2

---

### Phase 2: 感知与处理 🔄 (进行中)

**当前状态**：✅ 部分完成
- [x] ✅ 编写意图识别翻译官 (`interpreter.py`)
- [x] ✅ 实现提示词管理模块 (`prompts.py`)
- [x] ✅ 时间解析优化（注入当前时间信息）
- [ ] 实现 NL -> SQL 的精准映射
- [ ] 引入"模糊时间"预处理逻辑
- [ ] 开发简单的 CLI 交互入口

---

### Phase 2: 感知与处理 🔄 (下一步)

**目标**：实现自然语言理解和意图识别

**重点任务**（按优先级排序）：
1. [ ] 编写意图识别翻译官 (`interpreter.py`)
   - 将自然语言转换为结构化操作
   - 支持任务创建、查询、更新
   - 支持偏好设置和查询
   - **注意**：先实现简单规则，再考虑 LLM 集成

2. [ ] 实现 NL -> SQL 的精准映射
   - 处理任务相关操作（添加、查询、更新状态）
   - 处理偏好相关操作（设置、查询）
   - 处理记忆相关操作（记录、查询）
   - **注意**：复用 `database.py` 中的函数，不要直接写 SQL

3. [ ] 引入"模糊时间"预处理逻辑
   - 解析"明天"、"下周一"、"3天后"等相对时间
   - 转换为 ISO 格式时间字符串
   - **注意**：使用 Python 的 `dateutil` 库，不要自己实现

4. [ ] 开发简单的 CLI 交互入口 (`main.py` 或 `cli.py`)
   - 命令行参数解析
   - 调用 interpreter 和 database 函数
   - 友好的错误提示
   - **注意**：保持简单，后续可以扩展为 GUI

**开发约束**：
- 必须使用 `database.py` 中的现有函数
- 不要直接操作数据库，通过函数接口
- 保持代码模块化，每个文件职责单一

---

### Phase 3: 主动性与进化 🎯 (核心功能)

**目标**：让 AI 助手具备主动性和学习能力

**重点任务**（按优先级排序）：
1. [ ] 后台守护进程：定时检查任务并系统弹窗通知
   - 使用 `schedule` 或 `APScheduler` 库
   - 定期查询 `tasks` 表中即将到期的任务
   - 使用 macOS 的 `osascript` 显示系统通知
   - **注意**：不要过于频繁，避免打扰用户

2. [ ] 异步反思脚本：深夜扫描 memory_logs，更新 preferences
   - 定时任务（如每天凌晨 2 点）
   - 分析最近的 memory_logs，提取模式
   - 调用 `update_habit()` 更新偏好置信度
   - **注意**：可以先用简单规则，后续集成 LLM 分析

3. [ ] 接入 macOS 语音合成 (`say` 命令)
   - 使用 `subprocess` 调用系统 `say` 命令
   - 在重要提醒时使用语音通知
   - **注意**：可选功能，不要强制使用

**开发约束**：
- 守护进程必须优雅退出（处理信号）
- 异步任务不要阻塞主程序
- 所有通知都要可配置（开关、频率）

---

### Phase 4: 工作流集成 🚀 (高级功能)

**目标**：深度集成用户的工作流程

**重点任务**（按优先级排序）：
1. [ ] 自动捕获当前活动窗口标题
   - 使用 macOS 的 `AppleScript` 或 `pyobjc`
   - 定期记录用户正在使用的应用和窗口
   - 存储到 `memory_logs` 表，context_tag 为 "work"
   - **注意**：需要用户授权，处理隐私问题

2. [ ] 生成每日工作效能复盘报告
   - 分析当天的任务完成情况
   - 统计工作时间和应用使用情况
   - 生成 Markdown 格式的报告
   - **注意**：先实现简单统计，后续可以加入 LLM 生成总结

**开发约束**：
- 所有系统级操作都需要用户明确授权
- 报告生成不要过于频繁，避免资源浪费
- 保持数据隐私，不泄露敏感信息

---

## 🎯 当前开发重点

**当前阶段**：Phase 2 - 感知与处理

**本周目标**：
1. 实现 `interpreter.py` 的基础框架
2. 完成简单的 NL -> 数据库操作映射
3. 实现基本的 CLI 入口

**开发提醒**：
- 不要跳过 Phase 2 直接做 Phase 3
- 每个功能完成后都要测试
- 保持代码简洁，避免过度设计

---

## 🔮 未来优化考虑

### 配置管理升级（YAML 方案）

**当前方案**：使用 Python 模块 (`prompts.py`) 管理提示词
- ✅ 简单实用，无外部依赖
- ✅ IDE 友好，类型安全
- ✅ 适合当前项目规模

**未来考虑**：如果需要更复杂的配置管理，可考虑迁移到 YAML

**适用场景**：
- 多环境配置（开发/生产/测试）
- 多语言支持（中英文提示词切换）
- 配置热更新（无需重启程序）
- 团队协作（非开发者也能修改配置）

**实现方案**：
```
Project Link/
├── prompts.yaml          # 提示词配置
├── config.py             # 配置管理类（读取 YAML）
└── ...
```

**注意**：只有在真正需要时才迁移，不要过早优化。

---

## 📝 开发日志

### 2024-XX-XX
- ✅ 完成 Phase 1：数据库架构和核心函数
- ✅ 创建项目文档（README.md, PLAN.md）
- ✅ 代码已提交到 GitHub

### 2024-XX-XX（最新）
- ✅ 完成 Phase 2 部分功能：
  - ✅ 实现意图识别翻译官 (`interpreter.py`)
  - ✅ 创建提示词管理模块 (`prompts.py`)
  - ✅ 优化时间解析（注入当前时间信息）
  - ✅ 测试验证功能正常

### 下一步
- [ ] 继续 Phase 2：实现 NL -> SQL 映射和 CLI 入口

---

## 🔄 更新说明

**如何更新本文件**：
1. 完成一个任务后，将 `[ ]` 改为 `[x]`
2. 在"开发日志"中记录完成的功能
3. 更新"当前开发重点"部分
4. 如果阶段完成，标记为 ✅ 并开始下一阶段

**重要**：每次提交代码前，确保本文件反映了最新的进度！
